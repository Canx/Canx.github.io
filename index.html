<!DOCTYPE html>
<html>
<head>
<title>Mapa del centre</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

<div class="container">
  <div class="control has-icons-right m-2">
    <input id="search-field" class="input fuzzy-search" type="text" placeholder="Cercar..."/>
    <span class="icon is-small is-right">
      <i class="fas fa-search"></i>
    </span>
  </div>
</div>
<div id="lista-centro" class="container">
   <div id="loader" class="container has-text-centered">
    <button class="button is-ghost is-large is-ghost is-loading">Carregant...</button>
   </div>
   <div class="list"></div>
</div>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js" integrity="sha512-93wYgwrIFL+b+P3RvYxi/WUFRXXUDSLCT2JQk9zhVGXuS2mHl2axj6d+R6pP+gcU5isMHRj1u0oYE/mWyt/RjA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script>

var seccion = "";
var options = {
  item: function(values) {
	  // Si aparece la sección, solo es sección
	  if (values.seccion && !values.nombre) {
	    seccion = values.seccion;
              return `<h1 class="title has-background-info has-text-white mb-0 has-text-centered">${values.seccion}</h1>`;
	  }
	  
	  var html_enlace = "";
	  var html_desc = "";
	  // Si aparece el enlace es clickable
	  if (values.enlace) {
	    html_enlace = `onclick="window.open('${values.enlace}');" style="cursor: pointer;" `
	  }

	  // Si aparece la descripción la ponemos
	  if (values.desc) { html_desc = `<div class="card-content"><div class="content"><span class="desc">${values.desc}</span></div></div>` }

	  // En todos los casos
	  return `<div class="card">
	  <header ${html_enlace} class="card-header">
    <p class="card-header-title has-background-link-light">
      <span class="seccion is-hidden">${seccion}</span><span class="nombre">${values.nombre}</span>
    </p>
  </header>
    ${html_desc}
</div>`;
  }
};


$(document).ready(function() {

  // Check for click events on the navbar burger icon
  $(".navbar-burger").click(function() {

      // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
      $(".navbar-burger").toggleClass("is-active");
      $(".navbar-menu").toggleClass("is-active");

  });
});

  // Add card
var listaCentro = new List('lista-centro', options);
var values = [];

$('#search-field').on('keyup', function() {
  var searchString = $(this).val();
  listaCentro.search(searchString);
});

fetch('https://script.google.com/macros/s/AKfycbzluh_D_hAvkd2tGMcD9n8PQNaJ7MZSUyZqNj2Bbr6-jhyp-AS7INum3PpLQcOv7WTjhQ/exec')
  .then(res => res.json())       
  .then((out) => {
	var seccion_data = "";
        out["data"].forEach(function(elemento) { 
	    if(elemento["seccion"]) {
	      seccion_data = elemento["seccion"];
	    }
            values.push({ seccion: seccion_data, nombre: elemento["nombre"], desc: elemento["desc"], enlace: elemento["enlace"] });
          });
	$("#loader").remove();
        listaCentro.add(values);
      })
   .catch(err => console.error(err));
</script>
</html> 
